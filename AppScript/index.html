<!doctype html>
<html>
  <?!= include('partials/head'); ?>
  <body>
    <div class="app">
      <?!= include('partials/header'); ?>

      <main>
      <!-- LOGIN -->
      <section class="card" id="loginCard">
        <h2>Login</h2>
        <p class="muted">Trainer auswählen und PIN eingeben.</p>

        <div class="grid">
          <label>Trainer</label>
          <select id="trainerSelect"></select>

          <label>PIN</label>
          <input id="pinInput" type="password" inputmode="numeric" placeholder="PIN" />

          <div></div>
          <button class="btn" id="btnLogin">Anmelden</button>
        </div>

        <div class="msg" id="loginMsg" style="display:none;"></div>
      </section>

      <!-- MAIN -->
      <section class="card" id="mainCard" style="display:none;">
        <div class="tabs">
          <button class="tab active" data-tab="trainings">Trainings</button>
          <button class="tab" data-tab="mine">Meine Einteilungen</button>
          <button class="tab" data-tab="billing">Abrechnung</button>
          <button class="tab" data-tab="admin" id="adminTabBtn" style="display:none;">Admin</button>
        </div>

        <!-- TRAININGS -->
        <div class="panel" id="panel-trainings">
          <div class="row">
            <h3>Trainingsliste</h3>
            <button class="btn ghost" id="btnRefresh">Aktualisieren</button>
          </div>

          <!-- FILTER BAR -->
          <div class="filterbar">
            <div class="filter">
              <label>Monat</label>
              <select id="filterMonth"></select>
            </div>
            <div class="filter">
              <label>Gruppe</label>
              <select id="filterGroup"></select>
            </div>
            <div class="filter">
              <label>Nur kritisch</label>
              <select id="filterCritical">
                <option value="0">Nein</option>
                <option value="1">Ja (kein Trainer)</option>
              </select>
            </div>
          </div>

          <div id="trainingsList" class="list"></div>
        </div>

        <!-- MINE -->
        <div class="panel" id="panel-mine" style="display:none;">
          <div class="row">
            <h3>Meine Einteilungen</h3>
            <button class="btn ghost" id="btnRefreshMine">Aktualisieren</button>
          </div>
          <div class="filterbar">
            <div class="filter">
              <label>Monat</label>
              <select id="filterMineMonth"></select>
            </div>
          </div>
          <div id="mineList" class="list"></div>
          <hr style="margin:12px 0; opacity:.25;">
          <div class="row">
            <h3>Nicht verfügbar</h3>
          </div>
          <div id="unavailList" class="list"></div>

          <p class="muted small">Check-in: am selben Tag. Nachtragen: ab Folgetag (mit Hinweis).</p>
        </div>

        <!-- BILLING -->
        <div class="panel" id="panel-billing" style="display:none;">
          <div class="row">
            <h3>Abrechnung</h3>
          </div>

          <div class="grid billingGrid">
            <label>Jahr</label>
            <input id="billYear" type="number" min="2020" max="2100" />

            <label>Halbjahr</label>
            <select id="billHalf">
              <option value="H1">H1 (Jan–Jun)</option>
              <option value="H2">H2 (Jul–Dez)</option>
            </select>

            <div></div>
            <button class="btn" id="btnBilling">Berechnen</button>
          </div>

          <div class="summary" id="billingSummary" style="display:none;"></div>
          <div id="billingList" class="list"></div>
        </div>

        <!-- ADMIN -->
        <div class="panel" id="panel-admin" style="display:none;">
          <div class="row">
            <h3>Admin</h3>
            <span class="muted">Trainingsstatus & Benutzer</span>
          </div>

          <div class="tabs subTabs">
            <button class="tab active" data-subtab="adminTrainings">Trainings</button>
            <button class="tab" data-subtab="adminUsers">Benutzer</button>
          </div>

          <!-- Admin: Trainings -->
          <div id="panel-adminTrainings">
            <!-- FILTER BAR ADMIN -->
            <div class="filterbar">
              <div class="filter">
                <label>Monat</label>
                <select id="filterAdminMonth">
                  <option value="ALL">Alle</option>
                </select>
              </div>
              <div class="filter">
                <label>Gruppe</label>
                <select id="filterAdminGroup">
                  <option value="ALL">Alle</option>
                </select>
              </div>
              <div class="filter">
                <label>Status</label>
                <select id="filterAdminStatus">
                  <option value="geplant">Aktiv / Geplant</option>
                  <option value="stattgefunden">stattgefunden</option>
                  <option value="ausgefallen">ausgefallen</option>
                  <option value="ALL">Alle</option>
                </select>
              </div>
              <button class="btn ghost" id="btnAdminRefresh">Aktualisieren</button>
            </div>

            <div class="muted small" style="margin:6px 0 8px;">
              „ausgefallen“ → Einteilungen werden nicht abgerechnet.
            </div>
            <div id="adminTrainingsList" class="list"></div>
          </div>

          <!-- Admin: Users -->
          <div id="panel-adminUsers" style="display:none;">
            <div class="row">
              <h3>Benutzerverwaltung</h3>
              <button class="btn ghost" id="btnAdminUsersRefresh">Aktualisieren</button>
            </div>

            <div class="card inner" style="margin-top:10px;">
              <h3>Trainer anlegen / bearbeiten</h3>
              <div class="grid">
                <label>trainer_id</label><input id="u_trainer_id" placeholder="T001">
                <label>Name</label><input id="u_name" placeholder="Max Mustermann">
                <label>Email</label><input id="u_email" placeholder="max@…">
                <label>PIN</label><input id="u_pin" placeholder="1234" inputmode="numeric">
                <label>Stundensatz (€)</label><input id="u_rate" placeholder="15" inputmode="decimal">
                <label>Aktiv</label>
                <select id="u_aktiv"><option value="TRUE">TRUE</option><option value="FALSE">FALSE</option></select>
                <label>Admin</label>
                <select id="u_admin"><option value="FALSE">FALSE</option><option value="TRUE">TRUE</option></select>
                <div></div>
                <button class="btn" id="btnAdminUserSave">Speichern</button>
              </div>
            </div>

            <div id="adminUsersList" class="list" style="margin-top:12px;"></div>
          </div>
        </div>
      </section>

      </main>

    </div>

      <!-- PROFILE MODAL -->
      <div class="modal" id="profileModal" style="display:none;">
        <div class="sheet">
          <div class="sheetHeader">
            <div>
              <div class="sheetTitle">Trainer-Details</div>
              <div class="sheetSub" id="profileSub"></div>
            </div>
            <button class="btn ghost small" id="profileClose">Schließen</button>
          </div>

          <div class="sheetBody">
            <div class="kv">
              <div class="k">Name</div><div class="v" id="profileName"></div>
              <div class="k">Trainer ID</div><div class="v" id="profileId"></div>
              <div class="k">Rolle</div><div class="v" id="profileRole"></div>
              <div class="k">Stundensatz</div><div class="v" id="profileRate"></div>
              <div class="k">E-Mail</div><div class="v" id="profileEmail"></div>
            </div>

            <hr style="margin:14px 0; opacity:.25;">

            <div class="row" style="align-items:flex-end;">
              <div style="flex:1;">
                <label>Aktuelle PIN</label>
                <input id="pinOld" type="password" inputmode="numeric" placeholder="****">
              </div>
              <div style="flex:1;">
                <label>Neue PIN (4–8 Ziffern)</label>
                <input id="pinNew" type="password" inputmode="numeric" placeholder="****">
              </div>
            </div>
            <div class="row" style="margin-top:10px;">
              <button class="btn" id="btnPinSave">PIN ändern</button>
              <div class="msg small" id="pinMsg" style="display:none;"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- TRAINING DETAILS MODAL -->
      <div class="modal" id="trainingModal" style="display:none;">
        <div class="sheet">
          <div class="sheetHeader">
            <div>
              <div class="sheetTitle">Training-Details</div>
              <div class="sheetSub" id="trainingSub"></div>
            </div>
            <button class="btn ghost small" id="trainingClose">Schließen</button>
          </div>

          <div class="sheetBody">
            <div class="list" id="trainingSignupList"></div>
            <hr style="margin:12px 0; opacity:.25;">
            <div class="muted small" style="margin:0 0 8px;">Nicht verfügbar</div>
            <div class="list" id="trainingUnavailableList"></div>

            <hr style="margin:12px 0; opacity:.25;">
            <div class="muted small" style="margin:0 0 8px;">Trainingsplan</div>
            <div class="card inner" id="trainingPlanView" style="margin-bottom:10px;">
              <div class="item" style="margin:0;">
                <div class="itemMain">
                  <div class="itemTitle" id="trainingPlanTitle"></div>
                  <div class="itemSub" id="trainingPlanContent" style="white-space:pre-line;"></div>
                </div>
                <div class="itemActions">
                  <a class="btn small" id="trainingPlanLink" href="#" target="_blank" rel="noopener" style="display:none;">Link</a>
                </div>
              </div>
              <div class="msg" id="planMsg" style="display:none; margin-top:8px;"></div>
            </div>

            <div class="card inner" id="trainingPlanAdmin" style="display:none;">
              <h4 style="margin:0 0 8px;">Trainingsplan bearbeiten</h4>
              <div class="grid">
                <label>Titel</label>
                <input id="planTitleInput" placeholder="Titel des Plans">

                <label>Inhalt</label>
                <textarea id="planContentInput" rows="4" placeholder="Details, Übungen, Hinweise"></textarea>

                <label>Link</label>
                <input id="planLinkInput" placeholder="https://...">
              </div>

              <div class="row" style="margin-top:8px;">
                <button class="btn" id="btnPlanSave">Speichern</button>
                <button class="btn ghost danger" id="btnPlanDelete">Löschen</button>
              </div>
            </div>

          </div>
        </div>
      </div>

      
    <?!= include('partials/footer'); ?>
    <?!= include('partials/scripts'); ?>
  </body>
</html>
